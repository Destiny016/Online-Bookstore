<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Browse Books - Book Nest</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <nav>
  <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="genres.html">Genres</a></li>
    <li><a href="books.html">Books</a></li>
    <li id="accountLink"><a href="login.html">Sign Up / Login</a></li>
    <li><a href="cart.html">Cart (<span id="cartCount">0</span>)</a></li>
  </ul>
</nav>


  <main>
    <h1 id="pageTitle">Browse Books</h1>

    <div class="search-container">
      <input type="text" id="bookSearch" placeholder="Search books or genres..." aria-label="Search books" />
    </div>

    <section class="book-grid" id="bookGrid">
      <!-- Example books -->
      <div class="book-card" data-genre="Mystery">
        <img src="images/books/mystery1.jpg" alt="Mystery Book" />
        <div class="book-title">The Mysterious Affair</div>
        <div class="book-genre">Mystery</div>
        <button class="add-to-cart">Add to Cart</button>
      </div>
      <div class="book-card" data-genre="Romance">
        <img src="images/books/romance1.jpg" alt="Romance Book" />
        <div class="book-title">Love in Bloom</div>
        <div class="book-genre">Romance</div>
        <button class="add-to-cart">Add to Cart</button>
      </div>
      <div class="book-card" data-genre="Fantasy">
        <img src="images/books/fantasy1.jpg" alt="Fantasy Book" />
        <div class="book-title">The Enchanted Realm</div>
        <div class="book-genre">Fantasy</div>
        <button class="add-to-cart">Add to Cart</button>
      </div>
    </section>
  </main>

  <script>
  const searchInput = document.getElementById('bookSearch');
  const bookGrid = document.getElementById('bookGrid');
  const pageTitle = document.getElementById('pageTitle');

  function filterBooks() {
    const filter = searchInput.value.toLowerCase();
    const cards = bookGrid.querySelectorAll('.book-card');
    cards.forEach(card => {
      const title = card.querySelector('.book-title').textContent.toLowerCase();
      const genre = card.dataset.genre.toLowerCase();
      card.style.display = (title.includes(filter) || genre.includes(filter)) ? '' : 'none';
    });
  }

  // Pre-fill search & update title if genre is in URL
  const urlParams = new URLSearchParams(window.location.search);
  const genreParam = urlParams.get('genre');
  if (genreParam) {
    searchInput.value = genreParam;
    pageTitle.textContent = `Browsing: ${genreParam} Books`;
    filterBooks();
  }

  searchInput.addEventListener('input', filterBooks);

  // Add to cart
  document.querySelectorAll('.add-to-cart').forEach(button => {
    button.addEventListener('click', () => {
      const card = button.closest('.book-card');
      const title = card.querySelector('.book-title').textContent;
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      const existing = cart.find(item => item.title === title);
      if (existing) {
        existing.quantity = (parseInt(existing.quantity) || 0) + 1;
      } else {
        cart.push({ title, quantity: 1 });
      }

      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
    });
  });

  // Update cart count safely
  function updateCartCount() {
    let cart;
    try {
      cart = JSON.parse(localStorage.getItem('cart')) || [];
      if (!Array.isArray(cart)) throw new Error("Invalid cart data");
    } catch (e) {
      // Reset cart if data is corrupted
      cart = [];
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    // Sanitize quantities
    cart = cart.filter(item => {
      item.quantity = parseInt(item.quantity);
      return !isNaN(item.quantity) && item.quantity > 0;
    });

    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = totalItems > 0 ? totalItems : 0;

    // Save back sanitized cart
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  window.addEventListener('load', updateCartCount);
</script>
<script src="auth.js"></script>


</body>
</html>







